# Coturn TURN server configuration for Snacka
# Documentation: https://github.com/coturn/coturn/wiki/turnserver

# Listener ports
listening-port=3478
tls-listening-port=5349

# Use fingerprint in TURN messages
fingerprint

# Long-term credential mechanism
lt-cred-mech

# Use static auth secret (time-limited credentials)
# The server will generate credentials using this secret
use-auth-secret
static-auth-secret=${TURN_SECRET}

# Realm (should match your domain)
realm=${TURN_REALM}

# Server name for STUN/TURN
server-name=snacka-turn

# Total allocation quota per user
total-quota=100

# Max bytes-per-second bandwidth per session
max-bps=0

# Stale nonce lifetime (seconds)
stale-nonce=600

# Certificate and key for TLS (TURNS)
# Uncomment and configure paths if using TLS:
# cert=/etc/coturn/certs/turn.crt
# pkey=/etc/coturn/certs/turn.key

# Disable TLS if no certs configured
no-tls
no-dtls

# Only allow TURN, not general relay
no-multicast-peers

# Logging
log-file=stdout
verbose

# Disable CLI
no-cli

# External IP - IMPORTANT: Set this to your server's public IP
# If behind NAT, set both external and relay IPs
# external-ip=${EXTERNAL_IP}
# Or use auto-detection (works on most VPS):
# external-ip=$(detect-external-ip)

# Relay ports range (UDP ports for media)
min-port=49152
max-port=49252

# Deny private IP ranges for relay (security)
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=100.64.0.0-100.127.255.255
denied-peer-ip=127.0.0.0-127.255.255.255
denied-peer-ip=169.254.0.0-169.254.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.0.0.0-192.0.0.255
denied-peer-ip=192.0.2.0-192.0.2.255
denied-peer-ip=192.88.99.0-192.88.99.255
denied-peer-ip=198.18.0.0-198.19.255.255
denied-peer-ip=198.51.100.0-198.51.100.255
denied-peer-ip=203.0.113.0-203.0.113.255
denied-peer-ip=240.0.0.0-255.255.255.255

# Allow connection to the Snacka server (if on same host)
# Uncomment if snacka-server is in the denied ranges above
# allowed-peer-ip=172.17.0.0-172.17.255.255

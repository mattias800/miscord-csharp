<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Snacka.Client.ViewModels"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             x:Class="Snacka.Client.Views.VideoSettingsView"
             x:DataType="vm:VideoSettingsViewModel">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="28" MaxWidth="600">
            <!-- Header -->
            <TextBlock Text="Video"
                       FontSize="24"
                       FontWeight="Bold"
                       Foreground="{StaticResource ForegroundBrush}"/>

            <!-- Camera Device Section -->
            <StackPanel Spacing="10">
                <TextBlock Text="CAMERA"
                           FontSize="11"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource Foreground3Brush}"/>
                <ComboBox ItemsSource="{Binding VideoDevices}"
                          SelectedValue="{Binding SelectedVideoDevice}"
                          SelectedValueBinding="{Binding Value}"
                          DisplayMemberBinding="{Binding DisplayName}"
                          Background="{StaticResource Content1Brush}"
                          Foreground="{StaticResource ForegroundBrush}"
                          MinWidth="320"
                          Padding="14,10"
                          CornerRadius="10"/>
            </StackPanel>

            <!-- Camera Test Section -->
            <Border Background="{StaticResource Content1Brush}" CornerRadius="16" Padding="24">
                <StackPanel Spacing="20">
                    <TextBlock Text="CAMERA TEST"
                               FontSize="11"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource Foreground3Brush}"/>

                    <!-- Test Button and Status -->
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Panel MinWidth="140">
                            <Button Command="{Binding TestCameraCommand}"
                                    Classes="btn-primary"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Center"
                                    IsVisible="{Binding !IsTestingCamera}">
                                <TextBlock Text="Test Camera" FontWeight="SemiBold"/>
                            </Button>
                            <Button Command="{Binding TestCameraCommand}"
                                    Classes="btn-danger"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Center"
                                    IsVisible="{Binding IsTestingCamera}">
                                <TextBlock Text="Stop Test" FontWeight="SemiBold" Foreground="White"/>
                            </Button>
                        </Panel>

                        <Button Command="{Binding RefreshDevicesCommand}"
                                Classes="btn-icon"
                                Padding="10"
                                ToolTip.Tip="Refresh camera devices">
                            <ui:SymbolIcon Symbol="Sync" Foreground="{StaticResource Foreground2Brush}" FontSize="16"/>
                        </Button>
                    </StackPanel>

                    <!-- Camera Preview -->
                    <Border Background="{StaticResource BackgroundBrush}"
                            CornerRadius="10"
                            Padding="4"
                            IsVisible="{Binding IsTestingCamera}"
                            HorizontalAlignment="Left">
                        <Image Source="{Binding PreviewBitmap}"
                               Width="320"
                               Height="240"
                               Stretch="Uniform"/>
                    </Border>

                    <!-- Camera Status -->
                    <StackPanel Spacing="10" IsVisible="{Binding IsTestingCamera}">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <TextBlock Text="Status:"
                                       FontSize="12"
                                       Foreground="{StaticResource Foreground3Brush}"/>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding CameraStatus}"
                                       FontSize="12"
                                       Foreground="{StaticResource SuccessBrush}"
                                       Margin="8,0,0,0"/>
                        </Grid>
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <TextBlock Text="Resolution:"
                                       FontSize="12"
                                       Foreground="{StaticResource Foreground3Brush}"/>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding Resolution}"
                                       FontSize="12"
                                       Foreground="{StaticResource ForegroundBrush}"
                                       Margin="8,0,0,0"/>
                        </Grid>
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <TextBlock Text="Frames received:"
                                       FontSize="12"
                                       Foreground="{StaticResource Foreground3Brush}"/>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding FrameCount}"
                                       FontSize="12"
                                       Foreground="{StaticResource ForegroundBrush}"
                                       Margin="8,0,0,0"/>
                        </Grid>
                    </StackPanel>

                    <!-- Instructions when not testing -->
                    <TextBlock Text="Click 'Test Camera' to verify your camera is working. You'll see status information and frame count."
                               FontSize="12"
                               Foreground="{StaticResource Foreground3Brush}"
                               TextWrapping="Wrap"
                               IsVisible="{Binding !IsTestingCamera}"/>
                </StackPanel>
            </Border>

            <!-- Info Text -->
            <TextBlock Text="Changes are saved automatically when you select a new device."
                       FontSize="12"
                       Foreground="{StaticResource Foreground3Brush}"
                       Margin="0,8,0,0"/>

            <!-- FFmpeg requirement notice -->
            <Border Background="{StaticResource Content1Brush}" CornerRadius="16" Padding="24">
                <StackPanel Spacing="10">
                    <TextBlock Text="REQUIREMENTS"
                               FontSize="11"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource Foreground3Brush}"/>
                    <TextBlock Text="Video capture requires FFmpeg to be installed:"
                               FontSize="12"
                               Foreground="{StaticResource Foreground3Brush}"
                               TextWrapping="Wrap"/>
                    <TextBlock Text="macOS: brew install ffmpeg"
                               FontSize="12"
                               Foreground="{StaticResource Foreground2Brush}"
                               FontFamily="Consolas,Monaco,monospace"/>
                    <TextBlock Text="Windows: winget install ffmpeg"
                               FontSize="12"
                               Foreground="{StaticResource Foreground2Brush}"
                               FontFamily="Consolas,Monaco,monospace"/>
                    <TextBlock Text="Linux: apt install ffmpeg"
                               FontSize="12"
                               Foreground="{StaticResource Foreground2Brush}"
                               FontFamily="Consolas,Monaco,monospace"/>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>

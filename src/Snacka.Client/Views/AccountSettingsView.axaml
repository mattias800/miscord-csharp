<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Snacka.Client.ViewModels"
             x:Class="Snacka.Client.Views.AccountSettingsView"
             x:DataType="vm:AccountSettingsViewModel">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="32" MaxWidth="600">
            <!-- Header -->
            <TextBlock Text="My Account"
                       FontSize="24"
                       FontWeight="Bold"
                       Foreground="{StaticResource ForegroundBrush}"/>

            <!-- Avatar Section -->
            <Border Background="{StaticResource Content1Brush}" CornerRadius="16" Padding="24">
                <StackPanel Spacing="20">
                    <TextBlock Text="AVATAR"
                               FontSize="11"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource Foreground3Brush}"/>

                    <StackPanel Orientation="Horizontal" Spacing="20">
                        <!-- Current Avatar -->
                        <Grid Width="100" Height="100">
                            <!-- Default avatar placeholder -->
                            <Border CornerRadius="50"
                                    IsVisible="{Binding !HasAvatar}">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                        <GradientStop Color="#338ef7" Offset="0"/>
                                        <GradientStop Color="#006FEE" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <TextBlock Text="{Binding Username, FallbackValue=?}"
                                           FontSize="36"
                                           FontWeight="Bold"
                                           Foreground="White"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>

                            <!-- Actual avatar image -->
                            <Border CornerRadius="50"
                                    ClipToBounds="True"
                                    IsVisible="{Binding HasAvatar}">
                                <Image Source="{Binding AvatarUrl}"
                                       Width="100"
                                       Height="100"
                                       Stretch="UniformToFill"/>
                            </Border>
                        </Grid>

                        <!-- Avatar actions -->
                        <StackPanel Spacing="10" VerticalAlignment="Center">
                            <Button Command="{Binding SelectAvatarCommand}"
                                    Classes="btn-primary"
                                    Content="Change Avatar"/>
                            <Button Command="{Binding DeleteAvatarCommand}"
                                    Classes="btn-secondary"
                                    Content="Remove Avatar"
                                    IsVisible="{Binding HasAvatar}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Selected image preview -->
                    <StackPanel Spacing="12" IsVisible="{Binding HasSelectedImage}">
                        <TextBlock Text="NEW AVATAR PREVIEW"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource Foreground3Brush}"/>
                        <StackPanel Orientation="Horizontal" Spacing="20">
                            <Border CornerRadius="50"
                                    ClipToBounds="True"
                                    Width="100"
                                    Height="100">
                                <Image Source="{Binding SelectedImage}"
                                       Width="100"
                                       Height="100"
                                       Stretch="UniformToFill"/>
                            </Border>
                            <StackPanel Spacing="10" VerticalAlignment="Center">
                                <Button Command="{Binding UploadAvatarCommand}"
                                        Classes="btn-primary"
                                        Content="Upload"
                                        IsEnabled="{Binding !IsUploadingAvatar}"/>
                                <Button Command="{Binding CancelAvatarSelectionCommand}"
                                        Classes="btn-secondary"
                                        Content="Cancel"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <!-- Avatar Message -->
                    <TextBlock Text="{Binding AvatarMessage}"
                               IsVisible="{Binding AvatarMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                               FontSize="13"
                               TextWrapping="Wrap"
                               Classes.error="{Binding AvatarMessageIsError}"
                               Classes.success="{Binding !AvatarMessageIsError}">
                        <TextBlock.Styles>
                            <Style Selector="TextBlock.success">
                                <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                            </Style>
                            <Style Selector="TextBlock.error">
                                <Setter Property="Foreground" Value="{StaticResource DangerBrush}"/>
                            </Style>
                        </TextBlock.Styles>
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- Profile Section -->
            <Border Background="{StaticResource Content1Brush}" CornerRadius="16" Padding="24">
                <StackPanel Spacing="20">
                    <TextBlock Text="PROFILE"
                               FontSize="11"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource Foreground3Brush}"/>

                    <!-- Loading indicator -->
                    <TextBlock Text="Loading profile..."
                               FontSize="14"
                               Foreground="{StaticResource Foreground2Brush}"
                               IsVisible="{Binding IsLoadingProfile}"/>

                    <StackPanel Spacing="20" IsVisible="{Binding !IsLoadingProfile}">
                        <!-- Email (read-only) -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="EMAIL"
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource Foreground3Brush}"/>
                            <Border Background="{StaticResource BackgroundBrush}" CornerRadius="10" Padding="14,12" Width="320" HorizontalAlignment="Left">
                                <TextBlock Text="{Binding Email}"
                                           FontSize="14"
                                           Foreground="{StaticResource Foreground3Brush}"/>
                            </Border>
                        </StackPanel>

                        <!-- Username -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="USERNAME"
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource Foreground3Brush}"/>
                            <TextBox Text="{Binding Username}"
                                     Classes="input-default"
                                     Width="320"
                                     HorizontalAlignment="Left"/>
                        </StackPanel>

                        <!-- Display Name -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="DISPLAY NAME"
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource Foreground3Brush}"/>
                            <TextBox Text="{Binding DisplayName}"
                                     Watermark="Leave blank to use username"
                                     Classes="input-default"
                                     Width="320"
                                     HorizontalAlignment="Left"/>
                            <TextBlock Text="This is how others will see your name. Supports emoji."
                                       FontSize="12"
                                       Foreground="{StaticResource Foreground3Brush}"/>
                        </StackPanel>

                        <!-- Status -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="STATUS"
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource Foreground3Brush}"/>
                            <TextBox Text="{Binding Status}"
                                     Watermark="What are you up to?"
                                     Classes="input-default"
                                     Width="320"
                                     HorizontalAlignment="Left"/>
                        </StackPanel>

                        <!-- Profile Message -->
                        <TextBlock Text="{Binding ProfileMessage}"
                                   IsVisible="{Binding ProfileMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                   FontSize="13"
                                   TextWrapping="Wrap"
                                   Classes.error="{Binding ProfileMessageIsError}"
                                   Classes.success="{Binding !ProfileMessageIsError}">
                            <TextBlock.Styles>
                                <Style Selector="TextBlock.success">
                                    <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                </Style>
                                <Style Selector="TextBlock.error">
                                    <Setter Property="Foreground" Value="{StaticResource DangerBrush}"/>
                                </Style>
                            </TextBlock.Styles>
                        </TextBlock>

                        <!-- Profile Buttons -->
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Button Command="{Binding SaveProfileCommand}"
                                    Classes="btn-primary"
                                    Content="Save Changes"
                                    IsEnabled="{Binding HasProfileChanges}"/>
                            <Button Command="{Binding ResetProfileCommand}"
                                    Classes="btn-secondary"
                                    Content="Reset"
                                    IsVisible="{Binding HasProfileChanges}"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Change Password Section -->
            <Border Background="{StaticResource Content1Brush}" CornerRadius="16" Padding="24">
                <StackPanel Spacing="20">
                    <TextBlock Text="CHANGE PASSWORD"
                               FontSize="11"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource Foreground3Brush}"/>

                    <StackPanel Spacing="8">
                        <TextBlock Text="CURRENT PASSWORD"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource Foreground3Brush}"/>
                        <TextBox Text="{Binding CurrentPassword}"
                                 PasswordChar="*"
                                 Classes="input-default"
                                 Width="320"
                                 HorizontalAlignment="Left"/>
                    </StackPanel>

                    <StackPanel Spacing="8">
                        <TextBlock Text="NEW PASSWORD"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource Foreground3Brush}"/>
                        <TextBox Text="{Binding NewPassword}"
                                 PasswordChar="*"
                                 Watermark="Min 8 characters"
                                 Classes="input-default"
                                 Width="320"
                                 HorizontalAlignment="Left"/>
                    </StackPanel>

                    <StackPanel Spacing="8">
                        <TextBlock Text="CONFIRM NEW PASSWORD"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource Foreground3Brush}"/>
                        <TextBox Text="{Binding ConfirmPassword}"
                                 PasswordChar="*"
                                 Classes="input-default"
                                 Width="320"
                                 HorizontalAlignment="Left"/>
                    </StackPanel>

                    <TextBlock Text="{Binding PasswordMessage}"
                               IsVisible="{Binding PasswordMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                               FontSize="13"
                               TextWrapping="Wrap"
                               Classes.error="{Binding PasswordMessageIsError}"
                               Classes.success="{Binding !PasswordMessageIsError}">
                        <TextBlock.Styles>
                            <Style Selector="TextBlock.success">
                                <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                            </Style>
                            <Style Selector="TextBlock.error">
                                <Setter Property="Foreground" Value="{StaticResource DangerBrush}"/>
                            </Style>
                        </TextBlock.Styles>
                    </TextBlock>

                    <Button Command="{Binding ChangePasswordCommand}"
                            Classes="btn-primary"
                            Content="Change Password"
                            HorizontalAlignment="Left"
                            IsEnabled="{Binding !IsChangingPassword}"/>
                </StackPanel>
            </Border>

            <!-- Delete Account Section -->
            <Border Background="{StaticResource Content1Brush}" CornerRadius="16" Padding="24">
                <StackPanel Spacing="16">
                    <TextBlock Text="DANGER ZONE"
                               FontSize="11"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource DangerBrush}"/>

                    <TextBlock Text="Deleting your account is permanent. All your data will be removed and cannot be recovered."
                               FontSize="14"
                               Foreground="{StaticResource Foreground2Brush}"
                               TextWrapping="Wrap"/>

                    <TextBlock Text="{Binding DeleteAccountError}"
                               Foreground="{StaticResource DangerBrush}"
                               FontSize="13"
                               IsVisible="{Binding DeleteAccountError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                               TextWrapping="Wrap"/>

                    <!-- Delete confirmation panel -->
                    <Panel>
                        <Button Command="{Binding ShowDeleteConfirmationCommand}"
                                Classes="btn-danger"
                                Content="Delete Account"
                                HorizontalAlignment="Left"
                                IsVisible="{Binding !ShowDeleteConfirmation}"/>

                        <StackPanel IsVisible="{Binding ShowDeleteConfirmation}" Spacing="12">
                            <TextBlock Text="Are you sure you want to delete your account?"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource DangerBrush}"/>
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <Button Command="{Binding DeleteAccountCommand}"
                                        Classes="btn-danger"
                                        Content="Yes, Delete My Account"
                                        IsEnabled="{Binding !IsDeletingAccount}"/>
                                <Button Command="{Binding CancelDeleteCommand}"
                                        Classes="btn-secondary"
                                        Content="Cancel"/>
                            </StackPanel>
                        </StackPanel>
                    </Panel>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Miscord.Client.ViewModels"
             x:Class="Miscord.Client.Views.ServerConnectionView"
             x:DataType="vm:ServerConnectionViewModel"
             x:CompileBindings="False">
    <Border Background="#36393f" Padding="40">
        <Grid RowDefinitions="Auto,*">
            <StackPanel Grid.Row="0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Top"
                        Width="450"
                        Spacing="20">

                <TextBlock Text="Connect to a Server"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="White"
                           HorizontalAlignment="Center"/>

                <TextBlock Text="Enter a server URL or paste a share link to get started"
                           FontSize="14"
                           Foreground="#b9bbbe"
                           HorizontalAlignment="Center"
                           TextWrapping="Wrap"
                           TextAlignment="Center"/>

                <!-- Server URL Input -->
                <StackPanel Spacing="8" Margin="0,20,0,0">
                    <TextBlock Text="SERVER ADDRESS"
                               FontSize="12"
                               FontWeight="Bold"
                               Foreground="#b9bbbe"/>
                    <TextBox Text="{Binding ServerUrl}"
                             Watermark="http://localhost:5000 or miscord://connect/..."
                             Background="#202225"
                             Foreground="White"
                             BorderThickness="0"
                             CornerRadius="4"
                             Padding="12"/>
                </StackPanel>

                <!-- Error Message -->
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="#f04747"
                           FontSize="14"
                           IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                           TextWrapping="Wrap"/>

                <!-- Server Info (shown after successful connection) -->
                <Border Background="#2f3136"
                        CornerRadius="8"
                        Padding="16"
                        IsVisible="{Binding IsConnected}">
                    <StackPanel Spacing="8">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Border Background="#5865f2"
                                    CornerRadius="8"
                                    Width="48"
                                    Height="48">
                                <TextBlock Text="M"
                                           Foreground="White"
                                           FontSize="20"
                                           FontWeight="Bold"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center" Spacing="4">
                                <TextBlock Text="{Binding ServerName}"
                                           Foreground="White"
                                           FontSize="16"
                                           FontWeight="SemiBold"/>
                                <TextBlock Text="{Binding ServerDescription}"
                                           Foreground="#b9bbbe"
                                           FontSize="13"
                                           IsVisible="{Binding ServerDescription, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Connect Button -->
                <Button Command="{Binding ConnectCommand}"
                        Background="#5865f2"
                        Foreground="White"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Padding="12"
                        CornerRadius="4"
                        FontWeight="SemiBold"
                        IsVisible="{Binding IsConnected, Converter={x:Static BoolConverters.Not}}">
                    <Button.Content>
                        <Panel>
                            <TextBlock Text="Connect" IsVisible="{Binding IsLoading, Converter={x:Static BoolConverters.Not}}"/>
                            <TextBlock Text="Connecting..." IsVisible="{Binding IsLoading}"/>
                        </Panel>
                    </Button.Content>
                </Button>

                <!-- Continue Button (shown after connection) -->
                <Button Command="{Binding ContinueCommand}"
                        Background="#3ba55c"
                        Foreground="White"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Padding="12"
                        CornerRadius="4"
                        FontWeight="SemiBold"
                        IsVisible="{Binding IsConnected}">
                    <TextBlock Text="Continue" VerticalAlignment="Center"/>
                </Button>
            </StackPanel>

            <!-- Saved Servers List -->
            <StackPanel Grid.Row="1"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Bottom"
                        Width="450"
                        Margin="0,0,0,40"
                        IsVisible="{Binding SavedServers.Count}">
                <TextBlock Text="SAVED SERVERS"
                           FontSize="12"
                           FontWeight="Bold"
                           Foreground="#72767d"
                           Margin="0,0,0,12"/>

                <ItemsControl x:Name="SavedServersList" ItemsSource="{Binding SavedServers}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Command="{Binding #SavedServersList.DataContext.SelectServerCommand}"
                                    CommandParameter="{Binding}"
                                    Background="#2f3136"
                                    Padding="12"
                                    Margin="0,4"
                                    CornerRadius="4"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch">
                                <Grid ColumnDefinitions="Auto,*">
                                    <Border Background="#5865f2"
                                            CornerRadius="6"
                                            Width="40"
                                            Height="40"
                                            Margin="0,0,12,0">
                                        <TextBlock Text="S"
                                                   Foreground="White"
                                                   FontSize="16"
                                                   FontWeight="Bold"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Name}"
                                                   Foreground="White"
                                                   FontSize="14"
                                                   FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Url}"
                                                   Foreground="#72767d"
                                                   FontSize="12"/>
                                    </StackPanel>
                                </Grid>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
